# 工程模式

## 概述
本部分概述了工程模式的开发流程，包括如何设置和运行项目。

### 开发环境准备
确保你已经安装了以下工具：
- Python 3.x
- Node.js 和 npm
- Docker（如果需要）
- 其他必要的库和依赖项

### 项目结构
项目的目录结构如下（详细可阅读readme.md）：
```
MedSynthAI/
├── agent_system/
│   ├── base/
│   ├── controller/
│   ├── evaluator/
│   ├── inquirer/
│   ├── monitor/
│   ├── prompter/
│   ├── recipient/
│   ├── triager/
│   └── virtual_patient/
├── data_processing/
├── Docx/
├── guidance/
├── research/
│   ├── dataset/
│   └── visualizations/
└── service/   （工程模式开发中）
│   ├── Frontend/   #前端
│   └── Backend/    #后端
│   └──API/         #API接口
└── ...
```

## Agent 介绍
以下是各个Agent的功能描述：

### Base Agent
- **功能**: 提供基础功能和工具集。
- **路径**: `agent_system/base/agent.py`

### Controller Agent
- **功能**: 控制其他Agent的行为和交互。
- **路径**: `agent_system/controller/agent.py`

### Evaluator Agent
- **功能**: 评估其他Agent的表现和输出。
- **路径**: `agent_system/evaluator/agent.py`

### Inquirer Agent
- **功能**: 处理用户输入和查询。
- **路径**: `agent_system/inquirer/agent.py`

### Monitor Agent
- **功能**: 监控系统状态和性能。
- **路径**: `agent_system/monitor/agent.py`

### Prompter Agent
- **功能**: 生成提示信息和指令。
- **路径**: `agent_system/prompter/agent.py`

### Recipient Agent
- **功能**: 处理和分发结果。
- **路径**: `agent_system/recipient/agent.py`

### Triager Agent
- **功能**: 对任务进行分类和优先级排序。
- **路径**: `agent_system/triager/agent.py`

### Virtual Patient Agent
- **功能**: 模拟患者行为，用于测试和训练。
- **路径**: `agent_system/virtual_patient/agent.py`

## Guidance
以下是`guidance`目录中的文件及其作用：

### department_comparison_guidance.json
- **功能**: 提供部门比较的指导信息。
- **路径**: `guidance/department_comparison_guidance.json`

### department_inquiry_guidance.json
- **功能**: 提供部门查询的指导信息。
- **路径**: `guidance/department_inquiry_guidance.json`

### init.py
- **功能**: 初始化`guidance`模块。
- **路径**: `guidance/init.py`

### loader.py
- **功能**: 加载指导信息。
- **路径**: `guidance/loader.py`

## Agent与Guidance文档的交互
每个Agent在执行任务时可以查阅`guidance`目录中的文档。具体来说，Agent会使用Retrieval-Augmented Generation (RAG)技术来查找相关的指导信息，并将其作为上下文提供给大型语言模型（LLM）进行分析。

### RAG流程
1. **文档加载**: 使用`loader.py`加载`guidance`目录中的文档。
2. **查询生成**: Agent根据当前任务生成查询请求。
3. **文档检索**: 使用封装好的工具调用知识库，检索与查询相关的文档片段。
4. **上下文生成**: 将检索到的文档片段与现有上下文结合，形成完整的上下文。
5. **LLM分析**: 将生成的上下文传递给LLM进行进一步分析和处理。

## 知识库
知识库用于存储和检索相关信息。Agent通过封装的工具调用来查询知识库，获取与任务相关的数据。

### 知识库查询
- **工具封装**: 知识库的查询功能被封装成工具，Agent可以通过调用这些工具来获取所需的信息。
- **RAG集成**: 查询结果与Agent的现有上下文结合，通过RAG技术增强LLM的分析能力。

## 前端开发
前端使用React框架构建。以下是开发步骤：

1. **安装依赖**
   ```bash
   cd frontend
   npm install
   ```

2. **启动开发服务器**
   ```bash
   npm run dev
   ```

3. **构建生产版本**
   ```bash
   npm run build
   ```

## 后端开发
后端使用Python和Flask框架构建。以下是开发步骤：

1. **安装依赖**
   ```bash
   pip install -r requirements.txt
   ```

2. **创建服务主文件**
   在`service`文件夹中创建一个`main.py`文件，该文件将包含处理前端请求和与后端交互的主要逻辑。初始版本将不包括`Virtual Patient Agent`。

3. **启动开发服务器**
   ```bash
   python service/main.py
   ```

4. **运行测试**
   ```bash
   pytest
   ```

## 前端开发
前端使用React框架构建。以下是开发步骤：

1. **合并分诊和预问诊界面**
   将现有的分诊和预问诊两个界面合并为一个界面，以简化用户体验。

2. **安装依赖**
   ```bash
   cd frontend
   npm install
   ```

3. **启动开发服务器**
   ```bash
   npm run dev
   ```

4. **构建生产版本**
   ```bash
   npm run build
   ```

## 注意
1. 目前的项目仓库为 https://github.com/SCUT-HCC/MedSynthAI
      1.1 目前的代码暂未合并至main分支，可暂时查看feat/research分支
      
2. 原有后端仓库为 
         git clone http://192.168.31.127:3000/kwj/MedSynthAI-PatientTriage.git
3. 原有前端仓库：
         git clone http://192.168.31.127:3000/CHY-FrontEnd/MedSynthAI-Frontend.git
4. 仓库无法打开或克隆联系我私发
