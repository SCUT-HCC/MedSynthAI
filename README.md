# MedSynthAI

一个基于多Agent协作的智能医疗问诊模拟系统，用于医疗AI对话质量评估和研究。

## 项目概述

MedSynthAI是一个研究性质的医疗对话系统，通过多个专业化Agent的协同工作，模拟真实的医患问诊过程。系统设计为双模式架构，既支持科研场景下的批量数据集评估，也支持工程场景下的实时交互服务。

### 核心能力

系统通过8个专业化Agent协同工作，实现完整的医疗问诊流程模拟。虚拟病人Agent基于真实病例数据自动回答医生询问，接诊Agent负责初步信息收集，分诊Agent根据病情决定问诊策略，监控Agent实时追踪任务完成度，任务控制器管理问诊阶段转换，提示词Agent优化询问质量，询问Agent生成专业医学问题，评估Agent从7个维度对问诊质量进行量化评价。

### 工作流程

问诊流程分为三个关键阶段。分诊阶段通过不超过4步的快速询问确定问诊重点方向，现病史阶段深入了解患者当前疾病的详细情况，既往史阶段收集患者历史健康信息。整个流程最多执行30步，每一步都经过精心设计的10个子步骤处理，确保问诊的专业性和完整性。

### 评估体系

系统建立了多维度的评估框架，从临床问诊能力评估医生询问的专业性和针对性，从沟通表达能力评估语言的清晰度和患者友好性，从信息收集全面性评估病史采集的完整程度，从整体专业性评估医学知识的准确运用，同时通过现病史、既往史和主诉的相似度分析，量化评估信息收集的准确性。所有维度采用0-5分评分标准，并提供详细的评价理由和改进建议。

## 技术架构

项目采用模块化分层架构设计，核心Agent系统提供统一的大语言模型接口和基础能力，支持DeepSeek、OpenAI和Ollama等多种模型后端，实现了并行请求处理和智能重试机制，确保系统的稳定性和高效性。

科研模式专注于批量数据集的自动化评估，通过预定义的完整工作流程处理整个病例数据集，生成详细的评估报告和统计分析结果。工程模式则设计用于实时交互场景，通过FastAPI提供RESTful接口，支持真实用户的多轮对话，采用有状态执行器管理会话持久化，使用SQLite进行轻量级数据存储，满足中小规模并发访问需求。

## 目录结构

```
MedSynthAI/
├── agent_system/          # Agent核心系统
│   ├── base/              # 基础Agent类和响应模型
│   ├── virtual_patient/   # 虚拟病人Agent
│   ├── recipient/         # 接诊Agent
│   ├── triager/           # 分诊Agent
│   ├── monitor/           # 监控Agent
│   ├── task_controller/   # 任务控制Agent
│   ├── prompter/          # 提示词Agent
│   ├── inquirer/          # 询问Agent
│   └── evaluator/         # 评估Agent
│
├── research/              # 科研模式（规划中）
│   ├── batch_runner.py    # 批量执行入口
│   ├── workflow/          # 完整工作流实现
│       ├── medical_workflow.py    # 主工作流控制器
│           ├── task_manager.py        # 任务阶段管理
│           ├── step_executor.py       # 步骤执行器
│           └── workflow_logger.py     # 日志记录
│   ├── dataset/           # 数据集管理
│   └── evaluation/        # 评估报告生成
│
├── service/               # 工程模式（规划中）
│   ├── main.py            # FastAPI应用入口
│   ├── api/               # RESTful接口
│   ├── core/              # 核心业务逻辑
│   ├── models/            # 数据模型
│   └── persistence/       # 数据持久化
    
```

## 快速开始

### 环境要求

- Python 3.12
- 支持的LLM后端：DeepSeek / 阿里百炼

### 安装依赖

```bash
# 使用uv包管理器
uv sync
```

## 开发规范

本项目遵循严格的研究型代码开发规范。所有方法签名必须包含完整的类型注解，确保代码的可读性和类型安全。每个模块、类和方法都需要提供详细的中文docstring，说明功能、参数、返回值和关键实现细节。遵循YAGNI原则，避免过早抽象和添加不必要的功能。使用阶段化注释组织复杂逻辑流程，提高代码的可维护性。

代码提交遵循Conventional Commits规范，使用feat、fix、docs、refactor等前缀清晰标识变更类型。所有提交信息应简洁专业，不包含AI工具署名或生成标识。

## 项目状态

当前项目处于活跃开发阶段，核心Agent系统和基础工作流已经实现。正在进行的重构工作包括将现有代码整合到双模式架构中，实现科研模式的批量评估能力，以及开发工程模式的实时交互服务。

## 重构计划

**目标时间线**: 2024年10月10日 - 11月15日

## 技术选型

- **核心框架**: Agno框架 (agno)
- **数据验证**: Pydantic v2
- **LLM接口**: 支持DeepSeek、阿里百炼
- **Web框架**: FastAPI (工程模式)
- **数据存储**: SQLite (工程模式)
- **依赖管理**: uv

## 许可证

本项目用于学术研究目的。
